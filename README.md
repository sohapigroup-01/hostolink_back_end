
// DANS LA BASE DE DONNER
J AI AJOUTE LE CHAMP CATEGORIE A LA TABLE LISTE NUMERO VERT ETABLISSEMENT SANTE

#                   INITIATION DU PROJET NETJS
# Hostolink Backend

Bienvenue dans le backend de **Hostolink**, une API construite avec **NestJS**, **PostgreSQL**, et **Docker** pour g√©rer les fonctionnalit√©s de paiement et d'√©pargne pour les soins de sant√©.

## üöÄ Fonctionnalit√©s principales
- Gestion des utilisateurs (authentification, r√¥les, permissions)
- Transactions financi√®res (d√©p√¥t, retrait, transfert)
- Int√©gration avec des services de paiement (Wave, PayPal, etc.)
- G√©olocalisation des √©tablissements de sant√©
- Notifications en temps r√©el avec Firebase
- S√©curit√© renforc√©e (JWT, bcrypt, validation des requ√™tes)

---

## üì¶ Pr√©requis
Avant de commencer, assurez-vous d'avoir install√© :

- [Node.js](https://nodejs.org/) (version 18+)
- [NestJS CLI](https://docs.nestjs.com/) (`npm install -g @nestjs/cli`)
- [PostgreSQL](https://www.postgresql.org/)
- [Docker](https://www.docker.com/) (optionnel, mais recommand√©)
- [T√©l√©charger] https://www.enterprisedb.com/downloads/postgres-postgresql-downloads

---

## ‚öôÔ∏è Installation
Clonez le projet et installez les d√©pendances :

```sh
# Cloner le d√©p√¥t
git clone https://github.com/votre-utilisateur/hostolink-backend.git
cd hostolink-backend

# Installer les d√©pendances
npm install
```

---

## üõ†Ô∏è Configuration
Avant de d√©marrer l'API, configurez l'environnement :

1. **Dupliquez** le fichier `.env.example` et renommez-le `.env`
2. **Modifiez** les variables selon votre environnement :

```env Local
PORT=3000
DATABASE_URL=postgresql://postgres:motdepasse@localhost:5432/hostolink_bd
JWT_SECRET=secret_jwt
FIREBASE_API_KEY=xxx
```

```env Sur render
# ‚úÖ Connexion PostgreSQL sur Supabase via le pooler avec SSL activ√©
DB_HOST=................supabase.com
DB_PORT=........
DB_NAME=......
DB_USER=postgres.............
DB_PASSWORD=......
DB_SSL=true

# ‚úÖ Configuration de Cloudinary
CLOUDINARY_CLOUD_NAME=...........
CLOUDINARY_API_KEY=...............
CLOUDINARY_API_SECRET=..............

# ‚úÖ Cl√© secr√®te pour JWT
JWT_SECRET=................
```

---

## üèóÔ∏è D√©marrer le serveur

### üîπ Mode d√©veloppement
```sh
npm run start:dev
```
L'API sera accessible sur `http://localhost:3000`

### üîπ Mode production
```sh
npm run build
npm run start:prod
```

---

## üõ†Ô∏è Utilisation avec Docker
Si vous utilisez **Docker**, vous pouvez lancer le projet sans installer PostgreSQL localement :

```sh
# D√©marrer PostgreSQL via Docker
docker-compose up -d
```

---

## üì° Documentation API
Une documentation **Swagger** est disponible apr√®s le d√©marrage du serveur :

Acc√©dez √† : [http://localhost:3000/api](http://localhost:3000/api)

---

## üîç Structure du projet
```
üìÇ src/
 ‚îú‚îÄ‚îÄ auth/            # Gestion de l'authentification (JWT, r√¥les)
 ‚îú‚îÄ‚îÄ users/           # Gestion des utilisateurs
 ‚îú‚îÄ‚îÄ transactions/    # Gestion des paiements et transferts
 ‚îú‚îÄ‚îÄ establishments/  # G√©olocalisation des √©tablissements de sant√©
 ‚îú‚îÄ‚îÄ notifications/   # Notifications en temps r√©el (Firebase)
 ‚îú‚îÄ‚îÄ app.module.ts    # Module principal
 ‚îú‚îÄ‚îÄ main.ts          # Point d'entr√©e de l'application
```

---

## üß™ Tests
Ex√©cutez les tests unitaires avec :
```sh
npm run test
```

Ou les tests e2e :
```sh
npm run test:e2e
```

---



## üìú Licence
Ce projet est sous licence **MIT**. Consultez le fichier `LICENSE` pour plus de d√©tails.

---

## üìû Contact
Si vous avez des questions, contactez-nous √† **contact@hostolink.com** ou ouvrez une issue sur GitHub.

---

üöÄ **D√©velopp√© avec ‚ù§Ô∏è par l'√©quipe Hostolink** https://sohapigroup-communication
        
        

#                          CONFIGURATION DE BASE


        Installer en s'assurant d'avoir cocher
            ‚úÖ PostgreSQL Server
            ‚úÖ pgAdmin 4
            ‚úÖ Command Line Tools (Important !)
            ‚úÖ Stack Builder
            D√©finis un mot de passe pour l‚Äôutilisateur postgres (NGUESSAN)
            Choisis le port par d√©faut (5432) (ne change pas sauf si n√©cessaire)
            Termine l‚Äôinstallation et red√©marre le PC

        - toucher Win > taper variable d'environnement > sous variale systeme > path > modifier > nouveau > coller > C:\Program Files\PostgreSQL\17\bin

        - Dans l'zxplorateur de fichier naviguer vers 
            >C:\Program Files\PostgreSQL\17\data

            ouvrir pg_hba.conf dans un √©diteur puis rajouter 
            >host    all             all             127.0.0.1/32            scram-sha-256
        
        - Ouvir le cmd et taper
            > psql -U postgres
            entrer le mdp , rendu postgres=#

        - Lister les bd 
            > \l 
        
        - Lister les utilisateur 
            > \du

        -Cr√©er un utilisateur 
            >CREATE USER dev_sohapigroup WITH PASSWORD 'mdp_dev√ß_sohapigroup';

        -Donner tous les autorisations 
            > ALTER USER dev_sohapigroup WITH SUPERUSER CREATEDB CREATEROLE;

        -Se connecter avec  
            > psql -U dev_sohapigroup -d postgres
            mdp
        
        -Cr√©er la base de donn√©es
            >createdb -U postgres hostolink_bd

        -Importer la base de donn√©es en fichiers sql (sauvagarde custom (.dump ou .backup).)
            > pg_restore -U postgres -d hostolink_bd "C:\Users\NGUESSAN.DESKTOP-38E6PIP\Desktop\SohapiGroup\hostolink_back-end\bd\hostolink_bd.sql"

        - Se connecter 
            > psql -U postgres -d hostolink_bd
        
        - Lister les tables 
            > \dt


#                 CONNECTER CETTE BD AU BACK-END(netjs) ET AU FRONT-END(flutter)*

        - Ouvrir le projet back-end dans un √©diteur 
            dans le fichier C:\Users\NGUESSAN.DESKTOP-38E6PIP\Desktop\SohapiGroup\hostolink_back-end\src\app.module.ts

            mettre le nom de l'utilisateur 
            son mdp 
            le nom de la base de donn√©e
        
        -Cr√©er un dossier pour une entit√© donn√© (user)
            pr√©ciser les champs leur types et restriction
        
        -Cr√©er les services et controller (a document√©)
        -ouvrir un cmd et taper 
            > npm run start

            s'il y'a des erreurs d'installation, les install√©s  et reprendre la commande

        - Ouvrir son navigateur puis taper
            > http://localhost:3000/users

            afficher tous les donn√©es dans la table utilisateurs

        -  Ouvrir le projet  fron-end , flutter dans un √©diteur (VsCode)

        -Cr√©er un fichier qui servira d'api dans le dossier services

        -installer la dependance htpp
        pour communiquer avec le back-end

        - mettre le code de connexion au back-end
            Importer de cette dependance
            pr√©siser l'URL de l'API
            pr√©ciser le mot cl√© de l'entit√© dans le back-end genre comme route en laravel
            recuper les utilisateur pr√©voir le cas d'erreur et mettre 
            pr√©ciser les champs √† remplir , url , le type de donn√©e json et les valeurs 

        - Cr√©er un fichiers pour afficher et inserer des donn√©es 
        - mettre sa classe dans le fichiers routes ou directement dans main.dart

        -faire 
            > flutter clean 
            > flutter pub get 
            > flutter run (Chrome)


#                       TEST DES ENPOINT AVEC POSTMAN

        - Installer et se connecter √† son compte 
        -inviter les collab
        - cr√©er une colection 

*-    ok - 1- MISSION : V√©rifier si un utilisateur existe*
    M√©thode : POST
    URL : http://localhost:3000/api/check-user
    BODY 
        {
        "identifier": "testemail@gmail.com"
        }

    
*-    ok - 2- MISSION : Enregistrer un utilisateur (Sans mot de passe)*
    M√©thode : POST
    URL : http://localhost:3000/api/register-user
    BODY 
        {
        "identifier": "testemail@gmail.com"
        }

    
*-    ok - 3-MISSION : D√©finir un mot de passe apr√®s inscription*
    M√©thode : POST
    URL :http://localhost:3000/api/define-password
    BODY 
        {
        "identifier": "testemail@gmail.com",
        "password": "MonMotDePasse123"
        }

*-    ok - 4-MISSION : G√©n√©rer un OTP*
    M√©thode : POST
    URL : http://localhost:3000/api/generate-otp
    BODY 
        {
        "identifier": "testemail@gmail.com"
        }


*-    ok - 5-MISSION :  V√©rifier un OTP*
    M√©thode : POST
    URL : http://localhost:3000/api/verify-otp
    BODY 
        {
        "identifier": "testemail@gmail.com",
        "otpCode": "123456"
        }



*-    ok - 6-MISSION :   V√©rifier le PIN (mot de passe)*
    M√©thode : POST
    URL : http://localhost:3000/api/verify-pin
    BODY 
        {
        "identifier": "testemail@gmail.com",
        "otpCode": "123456"
        }
    
*-    ok -7-MISSION :R√©cup√©rer tous les utilisateurs (Test Admin uniquement)*
    M√©thode : POST
    URL : http://localhost:3000/api/verify-pin
    BODY 
        {
        "identifier": "testemail@gmail.com",
        "otpCode": "123456"
        }
    
*-    ok -7-MISSION :R√©cup√©rer tous les utilisateurs (Test Admin uniquement)*
    M√©thode : POST
    URL : http://localhost:3000/api/verify-pin
    BODY 
        {
        "identifier": "testemail@gmail.com",
        "otpCode": "123456"
        }

*----------RECAP DES ENDPINT DEVELOPPER ------------------*

    üéØ Objectif initial :
     mettre en place un syst√®me d‚Äôauthentification s√©curis√© dans ton back-end NestJS avec :

    üîë Inscription & Gestion du mot de passe
        üì≤ G√©n√©ration et v√©rification de l‚ÄôOTP
        üîí Connexion s√©curis√©e avec JWT
        üîç R√©cup√©ration des donn√©es utilisateur apr√®s authentification
        ‚úÖ Ce qu‚Äôon a fait jusqu‚Äô√† pr√©sent :
    1Ô∏è‚É£ Gestion des utilisateurs

        ‚úî V√©rification de l'existence d‚Äôun utilisateur ‚Üí /api/check-user
        ‚úî Cr√©ation d‚Äôun compte sans mot de passe ‚Üí /api/register-user
        ‚úî D√©finition d‚Äôun mot de passe ‚Üí /api/define-password

    2Ô∏è‚É£ OTP (One-Time Password)
        ‚úî G√©n√©ration d‚Äôun OTP ‚Üí /api/generate-otp
        ‚úî V√©rification d‚Äôun OTP ‚Üí /api/verify-otp

    3Ô∏è‚É£ Authentification avec JWT
        ‚úî Mise en place de JWT (@nestjs/jwt et passport-jwt)
        ‚úî Connexion et g√©n√©ration d‚Äôun Token JWT ‚Üí /api/auth/login
        ‚úî Cr√©ation d‚Äôun JwtStrategy et JwtAuthGuard
        ‚úî V√©rification du Token JWT pour r√©cup√©rer les infos utilisateur ‚Üí /api/user/me

    üõ† Ce qu'on a mis en place au niveau du code :

        üìÅ ENSPOINT INSCRIPTION - CONNEXION - OTP - TOKEN CONNEXION  :
            - user.controller.ts ‚Üí Routes utilisateur
            - user.service.ts ‚Üí Gestion des utilisateurs
            - otp.service.ts ‚Üí Gestion des OTPs
            - jwt.strategy.ts ‚Üí V√©rification des tokens JWT
            - auth.module.ts ‚Üí Configuration JWT et Passport
            - auth.service.ts ‚Üí Validation des identifiants et g√©n√©ration du token
            - jwt-auth.guard.ts ‚Üí Protection des routes avec JWT
            - auth.controller.ts ‚Üí Connexion utilisateur
